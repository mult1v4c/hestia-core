services:
  hestia:
    container_name: hestia-core
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "${HOST_PORT:-8080}:80"
    environment:
      NGINX_LISTEN_PORT: ${NGINX_LISTEN_PORT:-80}
      ENABLE_PIHOLE_PROXY: ${ENABLE_PIHOLE_PROXY:-true}
      PIHOLE_PROXY_PATH: ${PIHOLE_PROXY_PATH:-/pi-api/}
      PIHOLE_PROXY_TARGET: ${PIHOLE_PROXY_TARGET:-https://pihole}
      PIHOLE_HOST_HEADER: ${PIHOLE_HOST_HEADER:-pi.hole}
      PIHOLE_SSL_VERIFY: ${PIHOLE_SSL_VERIFY:-off}
      ENABLE_DELUGE_PROXY: ${ENABLE_DELUGE_PROXY:-true}
      DELUGE_PROXY_PATH: ${DELUGE_PROXY_PATH:-/deluge-api/}
      DELUGE_PROXY_TARGET: ${DELUGE_PROXY_TARGET:-http://deluge:8112/}
      DELUGE_HOST_HEADER: ${DELUGE_HOST_HEADER:-$$host}
      ENABLE_JELLYFIN_PROXY: ${ENABLE_JELLYFIN_PROXY:-true}
      JELLYFIN_PROXY_PATH: ${JELLYFIN_PROXY_PATH:-/jellyfin-api/}
      JELLYFIN_PROXY_TARGET: ${JELLYFIN_PROXY_TARGET:-http://jellyfin:8096/}
      JELLYFIN_HOST_HEADER: ${JELLYFIN_HOST_HEADER:-$$host}
    volumes:
      - ./config/nginx:/etc/nginx/server.d:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://127.0.0.1:${NGINX_LISTEN_PORT:-80} > /dev/null"]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 5s
    networks:
      - hestia

networks:
  hestia:
    driver: bridge
